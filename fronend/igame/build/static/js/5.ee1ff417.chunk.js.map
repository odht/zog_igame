{"version":3,"sources":["../static/js/5.ee1ff417.chunk.js","App/App2/Sign/NewTeamForm.js"],"names":["webpackJsonp","1158","module","__webpack_exports__","__webpack_require__","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","defineProperty","__WEBPACK_IMPORTED_MODULE_0_react__","__WEBPACK_IMPORTED_MODULE_0_react___default","n","__WEBPACK_IMPORTED_MODULE_1_antd__","__WEBPACK_IMPORTED_MODULE_2_antd_mobile__","__WEBPACK_IMPORTED_MODULE_3__User_session__","__WEBPACK_IMPORTED_MODULE_4__OdooRpc_Game__","__WEBPACK_IMPORTED_MODULE_5__OdooRpc_GameTeam__","_createClass","defineProperties","target","props","i","length","descriptor","key","protoProps","staticProps","FormItem","Item","Option","FormForSign","_React$Component","_ref","_temp","_this","_ret","this","_len","arguments","args","Array","_key","getPrototypeOf","apply","concat","state","eventDetail","myFriends","userList","userList2","mySelf","teamId","stateFriends","res","setState","filter","item","name","get_name","info","requestFail","fail","onSubmit","e","preventDefault","newTeamForm","form","validateFields","err","getFieldValue","map","push","newTeamSign","createFail","create_team","teamSign","forEach","obj","id","role","signEvent","registerFail","register_game","setToast","success","cancelSubmit","handleCoach","handlePlayer","index","handlePlayerDe","validateTeamName","rule","callback","pattern","test","Error","validatePlayer","items","a","createElement","disabled","get_users","_this2","_props$form","getFieldProps","getFieldDecorator","layout","label","style","marginBottom","rules","required","validator","placeholder","width","assign","notFoundContent","defaultValue","message","showSearch","onSelect","mode","onDeselect","type","paddingLeft","paddingRight","marginRight","htmlType","onClick","Component","SignForm"],"mappings":"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","file":"static/js/5.ee1ff417.chunk.js","sourcesContent":["webpackJsonp([5],{\n\n/***/ 1158:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_react__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_react___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_react__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_antd__ = __webpack_require__(19);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_antd_mobile__ = __webpack_require__(16);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__User_session__ = __webpack_require__(130);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__OdooRpc_Game__ = __webpack_require__(48);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__OdooRpc_GameTeam__ = __webpack_require__(214);\nvar _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");}return call&&(typeof call===\"object\"||typeof call===\"function\")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!==\"function\"&&superClass!==null){throw new TypeError(\"Super expression must either be null or a function, not \"+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}// import  { GameTeam, Game }  from '../../Models/Models'\n// import  Models  from '../../Models/Models'\nvar FormItem=__WEBPACK_IMPORTED_MODULE_1_antd__[\"d\" /* Form */].Item;var Option=__WEBPACK_IMPORTED_MODULE_1_antd__[\"h\" /* Select */].Option;var FormForSign=function(_React$Component){_inherits(FormForSign,_React$Component);function FormForSign(){var _ref;var _temp,_this,_ret;_classCallCheck(this,FormForSign);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=FormForSign.__proto__||Object.getPrototypeOf(FormForSign)).call.apply(_ref,[this].concat(args))),_this),_this.state={eventDetail:_this.props.eventDetail,//要报名赛事的全部信息\nmyFriends:null,userList:null,userList2:null,mySelf:null,teamId:null// 请求通讯录列表  ★\n},_this.stateFriends=function(res){if(res&&res.length!==0){_this.setState({myFriends:res,userList:res.filter(function(item){return item.name!==__WEBPACK_IMPORTED_MODULE_3__User_session__[\"a\" /* default */].get_name();}),userList2:res.filter(function(item){return item.name!==__WEBPACK_IMPORTED_MODULE_3__User_session__[\"a\" /* default */].get_name();}),mySelf:res.filter(function(item){return item.name===__WEBPACK_IMPORTED_MODULE_3__User_session__[\"a\" /* default */].get_name();})[0]});}else{__WEBPACK_IMPORTED_MODULE_2_antd_mobile__[\"n\" /* Toast */].info('没有用户信息，请先添加好友！！',2);}},_this.requestFail=function(){__WEBPACK_IMPORTED_MODULE_2_antd_mobile__[\"n\" /* Toast */].fail('查询用户列表失败，请稍后重试！！',1);},_this.onSubmit=function(e){e.preventDefault();var newTeamForm=[];_this.props.form.validateFields(function(err){if(!err){_this.props.form.getFieldValue('player').map(function(item){return newTeamForm.push(item);});newTeamForm.push(_this.props.form.getFieldValue('leader'));newTeamForm.push(_this.props.form.getFieldValue('coach'));// const m = Models.create();\n// m.query('exec', 'og.igame.team','create_team',{},this.newTeamSign,this.createFail,this.props.form.getFieldValue('teamname'),newTeamForm);\nvar m=new __WEBPACK_IMPORTED_MODULE_5__OdooRpc_GameTeam__[\"a\" /* default */](_this.newTeamSign,_this.createFail);m.create_team(_this.props.form.getFieldValue('teamname'),newTeamForm);}else{__WEBPACK_IMPORTED_MODULE_2_antd_mobile__[\"n\" /* Toast */].fail('验证失败，请重新填写表单',2);}});},_this.createFail=function(){__WEBPACK_IMPORTED_MODULE_2_antd_mobile__[\"n\" /* Toast */].fail('创建赛队失败，请稍后重试',1);},_this.newTeamSign=function(res){_this.setState({teamId:res});var teamSign=[];_this.props.form.getFieldValue('player').forEach(function(item){var obj={};obj.id=item;obj.role='player';teamSign.push(obj);});teamSign.push({id:_this.props.form.getFieldValue('leader'),role:'leader'});teamSign.push({id:_this.props.form.getFieldValue('coach'),role:'coach'});// const m = Models.create();\n// m.query('exec', 'og.igame','register_game',{},this.signEvent,this.registerFail,this.state.eventDetail.id,this.state.teamId,teamSign);\nvar m=new __WEBPACK_IMPORTED_MODULE_4__OdooRpc_Game__[\"a\" /* default */](_this.signEvent,_this.registerFail);m.register_game(_this.state.eventDetail.id,_this.state.teamId,teamSign);},_this.signEvent=function(res){_this.props.setToast();__WEBPACK_IMPORTED_MODULE_2_antd_mobile__[\"n\" /* Toast */].success('报名成功，请到‘我-我的比赛’中查看',1);},_this.registerFail=function(){__WEBPACK_IMPORTED_MODULE_2_antd_mobile__[\"n\" /* Toast */].fail('报名失败，请稍后重试！！',1);},_this.cancelSubmit=function(){_this.props.cancelSubmit();},_this.handleCoach=function(key){_this.setState({userList2:_this.state.myFriends.filter(function(item){return item.name!==__WEBPACK_IMPORTED_MODULE_3__User_session__[\"a\" /* default */].get_name()&&item.id!==key;})});},_this.handlePlayer=function(key){_this.setState({userList:_this.state.userList.filter(function(item,index){return item.name!==__WEBPACK_IMPORTED_MODULE_3__User_session__[\"a\" /* default */].get_name()&&item.id!==key;})});},_this.handlePlayerDe=function(key){_this.setState({userList:_this.state.userList.concat(_this.state.userList2.filter(function(item,index){return item.name!==__WEBPACK_IMPORTED_MODULE_3__User_session__[\"a\" /* default */].get_name()&&item.id===key;}))});},_this.validateTeamName=function(rule,value,callback){var pattern=/[A-Za-z0-9_\\-\\u4e00-\\u9fa5]+/;if(value){if(pattern.test(value)&&value.length>2&&value.length<=10){callback();}else{callback(new Error('长度为3-10个字符，只能包含中文、数字、字母'));}}else{callback();}},_this.validatePlayer=function(rule,value,callback){if(value){if(value.length>1&&value.length<=6){callback();}else{callback(new Error('请选择2-6个队员'));}}else{callback();}},_this.items=function(state){var items=[];if(!state||state.length===0){return items=[];}else{state.forEach(function(item,index){items.push(__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(Option,{key:index,value:item.id,disabled:false},'\\u59D3\\u540D\\uFF1A',item.name,'\\uFF0C\\u8D5B\\u4E8B\\u8BC1\\u53F7\\uFF1A',item.id));});}return items;},_temp),_possibleConstructorReturn(_this,_ret);}_createClass(FormForSign,[{key:'componentWillMount',value:function componentWillMount(){// 每次打开报名页都重新请求\n// const m = Models.create();\n// m.query('exec', 'og.igame','get_users',{},this.stateFriends,this.requestFail,[]);\nvar m=new __WEBPACK_IMPORTED_MODULE_4__OdooRpc_Game__[\"a\" /* default */](this.stateFriends,this.requestFail);m.get_users();}// 创建新队伍（不设置人员身份），提交表单\n// 设置队伍人员身份，提交表单，发送报名请求\n// 取消报名，返回选择报名方式页面 ★\n// 教练 ，值发生改变 ★\n// 队员 ，值发生改变 ★\n// 以下为验证表单数据\n},{key:'render',value:function render(){var _this2=this;var _props$form=this.props.form,getFieldProps=_props$form.getFieldProps,getFieldDecorator=_props$form.getFieldDecorator;return __WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_antd__[\"d\" /* Form */],{layout:'vertical',onSubmit:this.onSubmit},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(FormItem,{label:'\\u961F\\u4F0D\\u540D\\u79F0',style:{marginBottom:0}},getFieldDecorator('teamname',{rules:[{required:true},{validator:this.validateTeamName}]})(__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_antd__[\"f\" /* Input */],{placeholder:'\\u586B\\u5199\\u961F\\u4F0D\\u540D\\u79F0',style:{width:290}}))),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(FormItem,{style:{marginBottom:0}},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement('span',null,'\\u961F\\u4F0D\\u6210\\u5458(4-8\\u4EBA)\\uFF1A')),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(FormItem,{label:'\\u9886\\u961F',style:{marginBottom:0}},__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_antd__[\"h\" /* Select */],Object.assign({placeholder:'\\u59D3\\u540D',notFoundContent:'\\u6CA1\\u6709\\u7528\\u6237\\u4FE1\\u606F',defaultValue:this.state.mySelf?this.state.mySelf.id:null,style:{width:290}},getFieldProps('leader')),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(Option,{key:this.state.mySelf?this.state.mySelf.id:null,value:this.state.mySelf?this.state.mySelf.id:null,disabled:false},'\\u59D3\\u540D\\uFF1A',this.state.mySelf?this.state.mySelf.name:null,'\\uFF0C\\u8D5B\\u4E8B\\u8BC1\\u53F7\\uFF1A',this.state.mySelf?this.state.mySelf.id:null))),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(FormItem,{label:'\\u6559\\u7EC3',style:{marginBottom:0}},getFieldDecorator('coach',{rules:[{required:true,message:'请选择一名教练'}]})(__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_antd__[\"h\" /* Select */],{placeholder:'\\u59D3\\u540D',notFoundContent:'\\u6CA1\\u6709\\u7528\\u6237\\u4FE1\\u606F',showSearch:true,style:{width:290},onSelect:function onSelect(key){return _this2.handleCoach(key);}},this.items(this.state.userList)))),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(FormItem,{label:'\\u961F\\u5458',style:{marginBottom:0}},getFieldDecorator('player',{rules:[{required:true},{validator:this.validatePlayer}]})(__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_antd__[\"h\" /* Select */],{mode:'multiple',notFoundContent:'\\u6CA1\\u6709\\u7528\\u6237\\u4FE1\\u606F',placeholder:'\\u59D3\\u540D',showSearch:true,style:{width:290},onSelect:function onSelect(key){return _this2.handlePlayer(key);},onDeselect:function onDeselect(key){return _this2.handlePlayerDe(key);}},this.items(this.state.userList2)))),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(FormItem,null,__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_antd__[\"a\" /* Button */],{type:'primary',style:{paddingLeft:10,paddingRight:10,marginRight:10},htmlType:'submit'},'\\u63D0\\u4EA4'),__WEBPACK_IMPORTED_MODULE_0_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_1_antd__[\"a\" /* Button */],{type:'danger',style:{paddingLeft:10,paddingRight:10},onClick:this.cancelSubmit},'\\u53D6\\u6D88')));}}]);return FormForSign;}(__WEBPACK_IMPORTED_MODULE_0_react___default.a.Component);var SignForm=__WEBPACK_IMPORTED_MODULE_1_antd__[\"d\" /* Form */].create()(FormForSign);/* harmony default export */ __webpack_exports__[\"default\"] = (SignForm);\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// static/js/5.ee1ff417.chunk.js","import React from 'react'\nimport { Form, Input, Select, Button} from 'antd';\nimport {Toast} from 'antd-mobile'  \n\nimport session from '../../User/session'\n// import  { GameTeam, Game }  from '../../Models/Models'\nimport Game from '../../OdooRpc/Game';\nimport GameTeam from '../../OdooRpc/GameTeam';\n// import  Models  from '../../Models/Models'\n\nconst FormItem = Form.Item;\nconst Option = Select.Option;\n\n\nclass FormForSign extends React.Component{\n    state={\n        eventDetail:this.props.eventDetail,//要报名赛事的全部信息\n        myFriends:null,\n        userList:null,\n        userList2:null,\n        mySelf:null,\n        teamId:null\n    }\n\n// 请求通讯录列表  ★\n    componentWillMount(){\n        // 每次打开报名页都重新请求\n        // const m = Models.create();\n        // m.query('exec', 'og.igame','get_users',{},this.stateFriends,this.requestFail,[]);\n        const m = new Game(this.stateFriends,this.requestFail);\n        m.get_users();\n    }\n    stateFriends=(res)=>{\n        if(res && res.length!==0){\n            this.setState({\n                myFriends:res,\n                userList:res.filter(item => {return item.name !== session.get_name()}),\n                userList2:res.filter(item => {return item.name !== session.get_name()}),\n                mySelf: res.filter( item => {return item.name === session.get_name()})[0],\n            });\n        }else{\n            Toast.info('没有用户信息，请先添加好友！！', 2);\n        }\n    }\n    requestFail=()=>{\n        Toast.fail('查询用户列表失败，请稍后重试！！',1)\n    }\n\n// 创建新队伍（不设置人员身份），提交表单\n    onSubmit=(e)=>{\n        e.preventDefault();\n        const newTeamForm = []\n        this.props.form.validateFields(\n            (err) => {\n                if (!err) {\n                    this.props.form.getFieldValue('player').map(item=>{return newTeamForm.push(item)})\n                    newTeamForm.push(this.props.form.getFieldValue('leader'));\n                    newTeamForm.push(this.props.form.getFieldValue('coach'));\n\n                    // const m = Models.create();\n                    // m.query('exec', 'og.igame.team','create_team',{},this.newTeamSign,this.createFail,this.props.form.getFieldValue('teamname'),newTeamForm);\n\n                    const m = new GameTeam(this.newTeamSign,this.createFail);\n                    m.create_team(this.props.form.getFieldValue('teamname'),newTeamForm);\n                }else{\n                    Toast.fail('验证失败，请重新填写表单', 2);\n                }\n            },\n        );\n    }\n    createFail=()=>{\n        Toast.fail('创建赛队失败，请稍后重试',1)\n    }\n\n// 设置队伍人员身份，提交表单，发送报名请求\n    newTeamSign=(res)=>{\n        this.setState({\n            teamId:res\n        })\n        const teamSign = [];\n        this.props.form.getFieldValue('player').forEach((item)=>{\n            const obj={};\n            obj.id=item;\n            obj.role='player';\n            teamSign.push(obj);\n        });\n        teamSign.push({id:this.props.form.getFieldValue('leader'),role:'leader'})\n        teamSign.push({id:this.props.form.getFieldValue('coach'),role:'coach'})\n\n        // const m = Models.create();\n        // m.query('exec', 'og.igame','register_game',{},this.signEvent,this.registerFail,this.state.eventDetail.id,this.state.teamId,teamSign);\n\n        const m = new Game(this.signEvent,this.registerFail);\n        m.register_game(this.state.eventDetail.id,this.state.teamId,teamSign);\n    }\n    signEvent =(res)=>{\n        this.props.setToast();\n        Toast.success('报名成功，请到‘我-我的比赛’中查看',1)\n    }\n    registerFail=()=>{\n        Toast.fail('报名失败，请稍后重试！！',1)\n    }\n\n// 取消报名，返回选择报名方式页面 ★\n    cancelSubmit=()=>{\n        this.props.cancelSubmit();\n    }\n\n// 教练 ，值发生改变 ★\n    handleCoach = (key)=>{\n        this.setState({\n            userList2:  this.state.myFriends.filter(item=> { return item.name !== session.get_name() && item.id !== key;})\n        })\n    }\n\n// 队员 ，值发生改变 ★\n    handlePlayer = (key)=>{\n        this.setState({\n            userList:   this.state.userList.filter((item,index) => { return item.name !== session.get_name() && item.id !== key;})\n        })\n    }\n    handlePlayerDe = (key)=>{\n        this.setState({\n            userList:   this.state.userList.concat(\n                            this.state.userList2.filter((item,index) => { return item.name !== session.get_name() && item.id === key;})\n                        )\n        })\n    }\n\n// 以下为验证表单数据\n    validateTeamName = (rule, value, callback) => {\n        let pattern=/[A-Za-z0-9_\\-\\u4e00-\\u9fa5]+/;\n        if(value){\n            if(pattern.test(value) && value.length > 2 && value.length <= 10){\n                callback();\n              } else {\n                callback(new Error('长度为3-10个字符，只能包含中文、数字、字母'));\n              }\n        }else{\n            callback();\n        }\n    }\n\n    validatePlayer = (rule, value, callback) => {\n        if(value){\n            if(value.length > 1 && value.length <= 6){\n                callback();\n              } else {\n                callback(new Error('请选择2-6个队员'));\n              }\n        }else{\n            callback();\n        }\n    }\n\n    items=(state)=>{\n        let items = [];\n        \n\t\tif(!state || state.length === 0 ) {\n            return items=[];\n        }\n        else {\n            state.forEach((item,index)=> {\n                items.push(\n                    <Option key={index} value={item.id} disabled={false}>姓名：{item.name}，赛事证号：{item.id}</Option>\n                );\n            });\n        }\n\n        return items\n    }\n\n    render(){\n        const {getFieldProps, getFieldDecorator } = this.props.form;\n\n        return(       \n            <Form layout=\"vertical\"   onSubmit={this.onSubmit}>\n                    <FormItem label=\"队伍名称\" style={{marginBottom:0}}>\n                         {getFieldDecorator('teamname', {\n                            rules: [\n                                { required: true},\n                                { validator: this.validateTeamName }\n                            ],\n                        })(\n                            <Input placeholder=\"填写队伍名称\" style={{ width: 290 }}/>\n                        )}\n                    </FormItem>\n                    <FormItem style={{marginBottom:0}}>\n                        <span>队伍成员(4-8人)：</span>\n                    </FormItem>\n                    <FormItem label=\"领队\"  style={{marginBottom:0}} >   \n                    <Select placeholder=\"姓名\" notFoundContent=\"没有用户信息\" defaultValue={this.state.mySelf ? this.state.mySelf.id :null } style={{ width: 290 }} {...getFieldProps('leader')}>\n                        <Option key={this.state.mySelf ? this.state.mySelf.id :null } value={this.state.mySelf ? this.state.mySelf.id :null} disabled={false}>姓名：{this.state.mySelf ? this.state.mySelf.name :null}，赛事证号：{this.state.mySelf ? this.state.mySelf.id :null}</Option>\n                    </Select>  \n                </FormItem>\n                <FormItem label=\"教练\"  style={{marginBottom:0}}>  \n                    {getFieldDecorator('coach', {\n                        rules: [{ required: true ,message:'请选择一名教练'}],\n                    })( \n                        <Select  placeholder=\"姓名\" notFoundContent=\"没有用户信息\" showSearch={true} style={{ width: 290 }} onSelect={key => this.handleCoach(key)}>\n                        {this.items(this.state.userList)}\n                        </Select>   \n                    )} \n                </FormItem>\n                <FormItem label=\"队员\"  style={{marginBottom:0}}>   \n                    {getFieldDecorator('player', {\n                        rules: [\n                            { required: true},\n                            { validator: this.validatePlayer }\n                        ],\n                    })(\n                        <Select mode=\"multiple\" notFoundContent=\"没有用户信息\" placeholder=\"姓名\" showSearch={true} style={{ width: 290 }} onSelect={key => this.handlePlayer(key)} onDeselect={key => this.handlePlayerDe(key)}>\n                        {this.items(this.state.userList2)}\n                        </Select>  \n                    )}\n                </FormItem>     \n                <FormItem>\n                    <Button type=\"primary\" style={{paddingLeft:10, paddingRight:10, marginRight:10}} htmlType=\"submit\">提交</Button>\n                    <Button type=\"danger\" style={{paddingLeft:10, paddingRight:10}} onClick={this.cancelSubmit}>取消</Button>\n                </FormItem>\n                </Form>      \n        )\n    }\n}\n\nconst SignForm = Form.create()(FormForSign);\n\nexport default SignForm;\n\n\n// WEBPACK FOOTER //\n// ./src/App/App2/Sign/NewTeamForm.js"],"sourceRoot":""}